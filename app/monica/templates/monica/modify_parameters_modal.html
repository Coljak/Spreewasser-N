<!-- This is the modal for all Monica Parameters as Forms -->
{% load django_bootstrap5 %}
{% load crispy_forms_tags %}

    <div class="modal-header">
      <h1 class="modal-title fs-5" id="modalLabel">{{ modal_title }}</h1>
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>

    <div class="modal-body">
      <form id="modalForm" method="POST" parameter-name="{{ parameter_name }}" parameter-id="{{ parameter_id }} {% if rotation_index %}rotation-index={{ rotation_index }}{% endif %}" data-action-url="{{ data_action_url }}">
        {% csrf_token %}
        {% if parameter_name == 'user-simulation-settings' %}
          {{ form.non_field_errors }}
          <div class="form-group">
            {{ form.name|as_crispy_field }}
            {{ form.use_secondary_yields |as_crispy_field }}
            {{ form.water_deficit_response_on |as_crispy_field }}
            {{ form.emergence_moisture_control_on |as_crispy_field }}
            {{ form.use_n_min_mineral_fertilising_method |as_crispy_field }}
          </div>
          <div class="card mb-3" id="n_min_fertilisation_params" style="display: none;">
            <div class="card-body">
              <h5 class="card-title">Automatic Mineral fertilisation</h5>
              <div class="form-group">
                {{ form.n_min_user_params_min |as_crispy_field }}
                {{ form.n_min_user_params_max |as_crispy_field }}
                {{ form.n_min_user_params_delay_in_days |as_crispy_field }}
                {{ form.n_min_fertiliser_partition |as_crispy_field }}
                {{ form.julian_day_automatic_fertilising |as_crispy_field }}
              </div>
            </div>
          </div>
          <div class="form-group">
            {{ form.use_automatic_irrigation |as_crispy_field }}
          </div>
          <div class="card mb-3" id="automatic_irrigation_params" style="display: none;">
            <div class="card-body">
              <h5 class="card-title">Automatic Irrigation</h5>
              <div class="form-group">
                {{ form.nitrogen_response_on | as_crispy_field }}
                {{ form.auto_irrigation_params_nitrate_concentration |as_crispy_field }}
                {{ form.auto_irrigation_params_sulfate_concentration |as_crispy_field }}
                {{ form.auto_irrigation_params_amount |as_crispy_field }}
                {{ form.auto_irrigation_params_threshold |as_crispy_field }}
              </div>
            </div>
          </div>

        {% else %}
          {{ form | crispy }}

        {% endif %}
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button 
            type="button" 
            class="btn btn-primary" 
            id="saveModalParameters"
            {% if is_default %}disabled{% endif %}
            >
            {{ modal_save_button }}
            </button>
            <button type="button" class="btn btn-primary" id="saveAsNewModalParameters">{{ modal_save_as_button }}</button>
            </button>
            <button type="button" class="btn btn-warning" id="deleteParameters"{% if is_default %}disabled{% endif %}>Delete Parameter Set</button>
          </div>
        
        </div>

      </form>   
    </div>
